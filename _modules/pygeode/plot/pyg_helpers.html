
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pygeode.plot.pyg_helpers &#8212; PyGeode 1.4.1rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pygtheme.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/pygeode_icon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link href="http://fonts.googleapis.com/css?family=Ubuntu:300,300italic,regular,italic,500,500italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700' rel='stylesheet' type='text/css'>

  </head><body>
      <div class="header" role="banner"><img class="logo" src="../../../_static/pygeode_logo.png" width=79px alt="Logo"/>
        <h1 class="heading"><a href="../../../index.html">
          <span>PyGeode 1.4.1rc1 documentation</span></a></h1>
        <h2 class="heading"><span>pygeode.plot.pyg_helpers</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../reference.html">Reference</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../tutorial.html">Tutorial</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../gallery/index.html">Gallery</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for pygeode.plot.pyg_helpers</h1><div class="highlight"><pre>
<span></span><span class="c1"># Shortcuts for plotting PyGeode vars</span>
<span class="c1"># Extends wrapper.py to automatically use information from the Pygeode Vars.</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">wrappers</span> <span class="k">as</span> <span class="n">wr</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">cnt_helpers</span> <span class="k">as</span> <span class="n">ch</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">_getplotatts</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39; Builds plotatts dictionary, using variable attributes as suitable defaults. &#39;&#39;&#39;</span>
  <span class="c1"># Use var.units over var.atts[&#39;units&#39;] if both exist</span>
  <span class="n">units</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">units</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">atts</span><span class="p">:</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">atts</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
  <span class="n">plt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">plotname</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">plotunits</span> <span class="o">=</span> <span class="n">units</span><span class="p">,</span> <span class="n">plotfmt</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">formatstr</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">plotatts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">plt</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">_buildaxistitle</span><span class="p">(</span><span class="n">plotname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plottitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotunits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">dummy</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="k">if</span> <span class="n">plottitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">plottitle</span>
  <span class="k">elif</span> <span class="n">plotname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="n">plotname</span>
  <span class="k">else</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

  <span class="k">if</span> <span class="n">plotunits</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span> <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39; [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="n">plotunits</span>

  <span class="k">return</span> <span class="n">title</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">_buildvartitle</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plottitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotunits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">dummy</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="k">if</span> <span class="n">plottitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">plottitle</span>
  <span class="k">elif</span> <span class="n">plotname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="n">plotname</span>
  <span class="k">else</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

  <span class="k">if</span> <span class="n">plotunits</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span> <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39; [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="n">plotunits</span>

  <span class="c1"># Add information on degenerate axes to the title</span>
  <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]:</span>
      <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">formatvalue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

  <span class="k">return</span> <span class="n">title</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">scalevalues</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
<span class="c1"># {{{</span>
   <span class="n">sf</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">plotatts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scalefactor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
   <span class="n">of</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">plotatts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
   <span class="n">v</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
   <span class="k">if</span> <span class="n">sf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">v</span> <span class="o">*=</span> <span class="n">sf</span>
   <span class="k">if</span> <span class="n">of</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">v</span> <span class="o">+=</span> <span class="n">of</span>
   <span class="k">return</span> <span class="n">v</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">axes_parm</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="n">vals</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
  <span class="n">lims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
  <span class="n">plt</span> <span class="o">=</span> <span class="n">_getplotatts</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plotscale&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">),</span> \
         <span class="n">_buildaxistitle</span><span class="p">(</span><span class="o">**</span><span class="n">plt</span><span class="p">),</span> \
         <span class="n">lims</span><span class="p">[::</span><span class="n">plt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plotorder&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> \
         <span class="n">axis</span><span class="o">.</span><span class="n">formatter</span><span class="p">(),</span> \
         <span class="n">axis</span><span class="o">.</span><span class="n">locator</span><span class="p">()</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">set_xaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="n">scale</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">axes_parm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
  <span class="n">pl</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">pad</span>

  <span class="n">prm</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">axprm</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">major_locator</span> <span class="o">=</span> <span class="n">loc</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">xscale</span><span class="p">:</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;xscale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">lim</span>

  <span class="k">if</span> <span class="n">lbl</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pyl</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
    <span class="n">axprm</span><span class="p">[</span><span class="s1">&#39;major_formatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
    <span class="n">axprm</span><span class="p">[</span><span class="s1">&#39;minor_formatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;xticklabels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="n">axes</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="o">**</span><span class="n">prm</span><span class="p">)</span>
  <span class="n">axes</span><span class="o">.</span><span class="n">setp_xaxis</span><span class="p">(</span><span class="o">**</span><span class="n">axprm</span><span class="p">)</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lbl</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="n">pl</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="n">pl</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
<span class="c1"># }}} </span>

<span class="k">def</span> <span class="nf">set_yaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="n">scale</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">axes_parm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
  <span class="n">pl</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">pad</span>

  <span class="n">prm</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">axprm</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">major_locator</span> <span class="o">=</span> <span class="n">loc</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">yscale</span><span class="p">:</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;yscale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">lim</span>

  <span class="k">if</span> <span class="n">lbl</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pyl</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
    <span class="n">axprm</span><span class="p">[</span><span class="s1">&#39;major_formatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
    <span class="n">axprm</span><span class="p">[</span><span class="s1">&#39;minor_formatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;yticklabels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="n">axes</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="o">**</span><span class="n">prm</span><span class="p">)</span>
  <span class="n">axes</span><span class="o">.</span><span class="n">setp_yaxis</span><span class="p">(</span><span class="o">**</span><span class="n">axprm</span><span class="p">)</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lbl</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">pt</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">pt</span><span class="p">]</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">build_projection</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="k">if</span> <span class="n">wr</span><span class="o">.</span><span class="n">cartopy_avail</span><span class="p">:</span>
    <span class="c1"># Use cartopy preferentially, if it is available.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wr</span><span class="p">,</span> <span class="s1">&#39;CartopyAxes&#39;</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>

    <span class="n">prd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;PlateCarree&#39;</span><span class="p">)</span>
    <span class="n">prd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wr</span><span class="o">.</span><span class="n">CartopyAxes</span><span class="p">(</span><span class="o">**</span><span class="n">prd</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">wr</span><span class="o">.</span><span class="n">basemap_avail</span><span class="p">:</span>
    <span class="c1"># Use basemap if available</span>
    <span class="n">prd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;cyl&#39;</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
    <span class="n">prd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">prd</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span>
    <span class="n">bnds</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">proj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sinu&#39;</span><span class="p">,</span> <span class="s1">&#39;moll&#39;</span><span class="p">,</span> <span class="s1">&#39;hammer&#39;</span><span class="p">,</span> <span class="s1">&#39;npstere&#39;</span><span class="p">,</span> <span class="s1">&#39;spstere&#39;</span><span class="p">,</span> <span class="s1">&#39;nplaea&#39;</span><span class="p">,</span> <span class="s1">&#39;splaea&#39;</span><span class="p">,</span> <span class="s1">&#39;npaeqd&#39;</span><span class="p">,</span> \
                          <span class="s1">&#39;spaeqd&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">,</span> <span class="s1">&#39;eck4&#39;</span><span class="p">,</span> <span class="s1">&#39;kav7&#39;</span><span class="p">,</span> <span class="s1">&#39;mbtfpq&#39;</span><span class="p">,</span> <span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="s1">&#39;nsper&#39;</span><span class="p">]:</span>
      <span class="n">bnds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;llcrnrlat&#39;</span><span class="p">:</span><span class="n">lats</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
              <span class="s1">&#39;urcrnrlat&#39;</span><span class="p">:</span><span class="n">lats</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
              <span class="s1">&#39;llcrnrlon&#39;</span><span class="p">:</span><span class="n">lons</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
              <span class="s1">&#39;urcrnrlon&#39;</span><span class="p">:</span><span class="n">lons</span><span class="o">.</span><span class="n">max</span><span class="p">()}</span>

    <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
      <span class="n">bnds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;boundinglat&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
      <span class="n">bnds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;boundinglat&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>

    <span class="n">bnds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prd</span><span class="p">)</span>
    <span class="n">prd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bnds</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wr</span><span class="o">.</span><span class="n">BasemapAxes</span><span class="p">(</span><span class="o">**</span><span class="n">prd</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">decorate_projection</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="k">if</span> <span class="n">wr</span><span class="o">.</span><span class="n">iscartopyaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="n">cst_def</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">resolution</span> <span class="o">=</span> <span class="s1">&#39;110m&#39;</span><span class="p">)</span>
    <span class="n">cst</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coastlines&#39;</span><span class="p">,</span> <span class="n">cst_def</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cst</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
      <span class="n">axes</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="o">**</span><span class="n">cst</span><span class="p">)</span>

    <span class="n">grd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gridlines&#39;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
      <span class="n">lblprjs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercator&#39;</span><span class="p">]</span>
      <span class="n">grd_def</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">axes</span><span class="o">.</span><span class="n">prj_name</span> <span class="ow">in</span> <span class="n">lblprjs</span><span class="p">:</span>
        <span class="n">grd_def</span><span class="p">[</span><span class="s1">&#39;draw_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">grd_def</span><span class="p">[</span><span class="s1">&#39;draw_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

      <span class="n">grd_def</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span>

      <span class="n">scale</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">xform</span><span class="p">,</span> <span class="n">xloc</span> <span class="o">=</span> <span class="n">axes_parm</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
      <span class="n">scale</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">yform</span><span class="p">,</span> <span class="n">yloc</span> <span class="o">=</span> <span class="n">axes_parm</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>

      <span class="c1"># Set default grid appearance and labeling if appropriate</span>
      <span class="n">grd_prm</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="k">if</span> <span class="n">grd_def</span><span class="p">[</span><span class="s1">&#39;draw_labels&#39;</span><span class="p">]:</span>
        <span class="n">grd_prm</span><span class="p">[</span><span class="s1">&#39;top_labels&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="kc">False</span>
        <span class="n">grd_prm</span><span class="p">[</span><span class="s1">&#39;right_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">grd_prm</span><span class="p">[</span><span class="s1">&#39;xformatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xform</span>
        <span class="n">grd_prm</span><span class="p">[</span><span class="s1">&#39;yformatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yform</span>

      <span class="k">if</span> <span class="s1">&#39;xlocs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grd_def</span><span class="p">:</span>
        <span class="n">grd_prm</span><span class="p">[</span><span class="s1">&#39;xlocator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xloc</span>

      <span class="k">if</span> <span class="s1">&#39;ylocs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grd_def</span><span class="p">:</span>
        <span class="n">grd_prm</span><span class="p">[</span><span class="s1">&#39;ylocator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yloc</span>

      <span class="n">mod_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rotate_labels&#39;</span><span class="p">,</span> <span class="s1">&#39;top_labels&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom_labels&#39;</span><span class="p">,</span> <span class="s1">&#39;right_labels&#39;</span><span class="p">,</span> <span class="s1">&#39;left_labels&#39;</span><span class="p">]</span>

      <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">mod_args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">grd_def</span><span class="p">:</span>
          <span class="n">grd_prm</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">grd_def</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

      <span class="n">gl</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="o">**</span><span class="n">grd_def</span><span class="p">)</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grd_prm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">modifygridlines</span><span class="p">(</span><span class="n">gl</span><span class="p">,</span> <span class="o">**</span><span class="n">grd_prm</span><span class="p">)</span>
  
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>

  <span class="k">elif</span> <span class="n">wr</span><span class="o">.</span><span class="n">isbasemapaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span> 
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bluemarble&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
      <span class="n">axes</span><span class="o">.</span><span class="n">bluemarble</span><span class="p">()</span>

    <span class="c1"># Add coastlines, meridians, parallels</span>
    <span class="n">cld</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">merd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">meridians</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">270</span><span class="p">,</span><span class="mi">360</span><span class="p">],</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">pard</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">circles</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">cld</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coastlines&#39;</span><span class="p">,</span> <span class="p">{}))</span>
    <span class="n">merd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;meridians&#39;</span><span class="p">,</span> <span class="p">{}))</span>
    <span class="n">pard</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;parallels&#39;</span><span class="p">,</span> <span class="p">{}))</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="o">**</span><span class="n">cld</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="o">**</span><span class="n">merd</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="o">**</span><span class="n">pard</span><span class="p">)</span>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">_parse_autofmt_kwargs</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39; Used by showvar and showgrid to parse kwargs for auto-contouring options. &#39;&#39;&#39;</span>

  <span class="c1"># Process auto contouring dictionaries</span>
  <span class="k">if</span> <span class="s1">&#39;clevs&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">or</span> <span class="s1">&#39;clines&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">tdef</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">tdef</span> <span class="o">=</span> <span class="s1">&#39;clf&#39;</span>

  <span class="n">typ</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">tdef</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">kwargs</span>
      
  <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;clf&#39;</span><span class="p">:</span>
    <span class="n">cdelt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cdelt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cdelt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">z</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
      <span class="n">style</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span>  <span class="kc">None</span><span class="p">)</span>
      <span class="n">ndiv</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ndiv&#39;</span><span class="p">,</span>  <span class="kc">None</span><span class="p">)</span>
      <span class="n">cdelt</span><span class="p">,</span> <span class="n">dct</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">guessclimits</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">ndiv</span><span class="o">=</span><span class="n">ndiv</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">if</span> <span class="s1">&#39;min&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;style&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;seq&#39;</span>
        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;ndiv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">dct</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">clfdict</span><span class="p">(</span><span class="n">cdelt</span><span class="p">,</span> <span class="o">**</span><span class="n">dct</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwargs</span>

  <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;cl&#39;</span><span class="p">:</span>
    <span class="n">cdelt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cdelt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cdelt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">z</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
      <span class="n">style</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span>  <span class="kc">None</span><span class="p">)</span>
      <span class="n">ndiv</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ndiv&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
      <span class="n">cdelt</span><span class="p">,</span> <span class="n">dct</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">guessclimits</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">ndiv</span><span class="o">=</span><span class="n">ndiv</span><span class="p">,</span> <span class="n">clf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ndiv</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ndiv&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
      <span class="nb">range</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="n">ndiv</span><span class="o">*</span><span class="n">cdelt</span><span class="p">)</span>
      <span class="n">dct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">)</span>
      <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">dct</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">cldict</span><span class="p">(</span><span class="n">cdelt</span><span class="p">,</span> <span class="o">**</span><span class="n">dct</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contour Interval: </span><span class="si">%0.2g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cdelt</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimum value: </span><span class="si">%3g</span><span class="s1">, Maximum value: </span><span class="si">%3g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimum contour: </span><span class="si">%3g</span><span class="s1">, Maximum contour: </span><span class="si">%3g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clines&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;clines&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">kwargs</span>

  <span class="k">elif</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;log1s&#39;</span><span class="p">]:</span>
    <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dct</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;cmin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must specify cmin (lower bound) for logarithmically spaced contours&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">log1sdict</span><span class="p">(</span><span class="o">**</span><span class="n">dct</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwargs</span>

  <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;log2s&#39;</span><span class="p">:</span>
    <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dct</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;cmin&#39;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">)</span> <span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must specify cmin (inner boundary for linear spaced interval) for two-sided logarithmically spaced contours&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">log2sdict</span><span class="p">(</span><span class="o">**</span><span class="n">dct</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kwargs</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized 2d plot type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">typ</span><span class="p">)</span>
<span class="c1"># }}}</span>

<span class="c1"># Do a 1D line plot</span>
<div class="viewcode-block" id="vplot"><a class="viewcode-back" href="../../../plot.html#pygeode.vplot">[docs]</a><span class="k">def</span> <span class="nf">vplot</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lblx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lbly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Create a line plot of a variable.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  var :  :class:`Var`</span>
<span class="sd">     The variable to plot. Should have 1 non-degenerate axis.</span>

<span class="sd">  fmt :  string, optional</span>
<span class="sd">     Format of the line. See :func:`pylab.plot`.</span>

<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Y</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">Y</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Variable to plot must have exactly one non-degenerate axis.&#39;</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

  <span class="n">yord</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="c1"># If a vertical axis is present transpose the plot</span>
  <span class="kn">from</span> <span class="nn">pygeode.axis</span> <span class="kn">import</span> <span class="n">ZAxis</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ZAxis</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
    <span class="n">yord</span> <span class="o">=</span> <span class="kc">False</span>

  <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
    <span class="n">yord</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">yord</span>

  <span class="k">if</span> <span class="n">yord</span><span class="p">:</span>
    <span class="n">scalex</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scalex&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">scaley</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scaley&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">scalex</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scalex&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">scaley</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scaley&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

  <span class="n">hold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hold&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>

  <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="c1"># Apply the custom axes args</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">hold</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">set_xaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">lblx</span><span class="p">,</span> <span class="n">scalex</span><span class="p">)</span>
    <span class="n">set_yaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">lbly</span><span class="p">,</span> <span class="n">scaley</span><span class="p">)</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="n">_getplotatts</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="n">lbl</span> <span class="o">=</span> <span class="n">_buildvartitle</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">plt</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">axes</span></div>
<span class="c1"># }}}</span>

<div class="viewcode-block" id="vhist"><a class="viewcode-back" href="../../../plot.html#pygeode.vhist">[docs]</a><span class="k">def</span> <span class="nf">vhist</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lblx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lbly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Create a histogram of values taken by a variable.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  var :  :class:`Var`</span>
<span class="sd">     The variable to compute the histogram of.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">V</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

  <span class="n">v</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>

  <span class="n">axes</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="c1"># Apply the custom axes args</span>
  <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
  <span class="n">set_xaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">lblx</span><span class="p">)</span>
  <span class="n">plt</span> <span class="o">=</span> <span class="n">_getplotatts</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
  <span class="n">lbl</span> <span class="o">=</span> <span class="n">_buildvartitle</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">plt</span><span class="p">)</span>
  <span class="n">axes</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">axes</span></div>
<span class="c1"># }}}</span>

<span class="c1"># Do a scatter plot</span>
<div class="viewcode-block" id="vscatter"><a class="viewcode-back" href="../../../plot.html#pygeode.vscatter">[docs]</a><span class="k">def</span> <span class="nf">vscatter</span><span class="p">(</span><span class="n">varx</span><span class="p">,</span> <span class="n">vary</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lblx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lbly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Create a scatter plot from two variables with the same shape.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  varx :  :class:`Var`</span>
<span class="sd">     Variable to use as abscissa values. Must have the same size as vary.</span>

<span class="sd">  vary :  :class:`Var`</span>
<span class="sd">     Variable to use as ordinate values.</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  Wraps matplotlib.scatter</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">assert</span> <span class="n">varx</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">vary</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;Variables must have same size to do a scatter plot.&#39;</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">varx</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">vary</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>

  <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="c1"># Apply the custom axes args</span>
  <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
  <span class="n">set_xaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">varx</span><span class="p">,</span> <span class="n">lblx</span><span class="p">)</span>
  <span class="n">set_yaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">vary</span><span class="p">,</span> <span class="n">lbly</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">axes</span></div>
<span class="c1"># }}}</span>

<span class="c1"># Do a 2D contour plot</span>
<div class="viewcode-block" id="vcontour"><a class="viewcode-back" href="../../../plot.html#pygeode.vcontour">[docs]</a><span class="k">def</span> <span class="nf">vcontour</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lblx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lbly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;Create a contour plot (lines, filled, or both) from a variable.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  var :  :class:`Var`</span>
<span class="sd">    The variable to plot. Should have 2 non-degenerate axes.</span>

<span class="sd">  clevs : integer or collection of numbers, optional</span>
<span class="sd">    Levels at which to construct filled contours through an underlying call to</span>
<span class="sd">    :func:`matplotlib.contourf`. If None is specified, no filled contours will</span>
<span class="sd">    be produced, unless clines is also None. If a number is specified, that</span>
<span class="sd">    number of equally spaced contours are chosen. Otherwise the explicit</span>
<span class="sd">    values are used.</span>

<span class="sd">  clines : integer or collection of numbers, optional</span>
<span class="sd">    Levels at which to construct contour lines through an underlying call to</span>
<span class="sd">    :func:`matplotlib.contour`. If None is specified, no contour lines are</span>
<span class="sd">    produced.  If a number is specified, that number of equally spaced contours</span>
<span class="sd">    are chosen. Otherwise the explicit values are used.</span>

<span class="sd">  axes : :class:`AxisWrapper`, optional</span>
<span class="sd">    Axes on which to produce contour plot. If none is specified, one is created.</span>

<span class="sd">  lblx : bool, optional</span>
<span class="sd">    If True, add appropriate tick labels and an axis label on the x axis; if</span>
<span class="sd">    False, the x axis a is left unlabeled. Defaults to True.</span>

<span class="sd">  lbly : bool, optional</span>
<span class="sd">    If True, add appropriate tick labels and an axis label on the y axis; if</span>
<span class="sd">    False, the y axis a is left unlabeled. Defaults to True.</span>

<span class="sd">  transpose : bool, optional</span>
<span class="sd">    The x and y axes are chosen based on the two degenerate axes of the variable</span>
<span class="sd">    to plot. This order can be reversed by setting transpose to True.</span>

<span class="sd">  map : dict, optional</span>
<span class="sd">    If</span>

<span class="sd">  *args, **kwargs : arguments to pass on to underlying matplotlib contour</span>
<span class="sd">    plotting routines, see Notes.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  axes : :class:`AxesWrapper`</span>
<span class="sd">    The axes object containing the contour plots.</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  If the two axes of the variable are a :class:`Lat` and :class:`Lon` axes,</span>
<span class="sd">  a map projection is created automatically.</span>

<span class="sd">  See Also</span>
<span class="sd">  --------</span>
<span class="sd">  showvar, colorbar</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">Z</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">Z</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Variable to contour must have two non-degenerate axes.&#39;</span>
  <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">axes</span>

  <span class="c1"># If a vertical axis is present transpose the plot</span>
  <span class="kn">from</span> <span class="nn">pygeode.axis</span> <span class="kn">import</span> <span class="n">ZAxis</span><span class="p">,</span> <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>
  <span class="k">if</span> <span class="n">transpose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ZAxis</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lat</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lon</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
  <span class="k">elif</span> <span class="n">transpose</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>

  <span class="nb">map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="p">{})</span>
  <span class="n">mapd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mapdecor&#39;</span><span class="p">,</span> <span class="p">{})</span>

  <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lon</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lat</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">axes</span> <span class="o">=</span> <span class="n">build_projection</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="nb">map</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">axes</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">clevs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">clines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># If both clevs and clines are None, use default</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">clevs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linewidths&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lw</span>
    <span class="c1"># Special case; if plotting both filled and unfilled contours</span>
    <span class="c1"># with a single call, set the color of the latter to black</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">clines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">clines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="c1"># Apply the custom axes args</span>
  <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wr</span><span class="o">.</span><span class="n">ismapaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">decorate_projection</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">mapd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">set_xaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">lblx</span><span class="p">)</span>
      <span class="n">set_yaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">lbly</span><span class="p">)</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="n">_getplotatts</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="n">_buildvartitle</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">plt</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">axes</span></div>
<span class="c1"># }}}</span>

<span class="c1"># Do a 2D significance mask</span>
<div class="viewcode-block" id="vsigmask"><a class="viewcode-back" href="../../../plot.html#pygeode.vsigmask">[docs]</a><span class="k">def</span> <span class="nf">vsigmask</span><span class="p">(</span><span class="n">pval</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">mjsig</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">mnsig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mjsigp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mnsigp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nsigp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Add significance shading to a contour plot from a variable.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  pval :  :class:`Var`</span>
<span class="sd">    The variable containing a p-value of the significance mask. The mask will</span>
<span class="sd">    be applied where abs(pval) &gt; mjsig (and optionally an additional mask will</span>
<span class="sd">    be applied for mnsig &lt; abs(pval) &lt; mjsig. Signed p-values for two-sided</span>
<span class="sd">    tests ensure that a gap will appear between significant regions of opposite sign.</span>
<span class="sd">    Should have two non-degenerate axes that match the quantity plotted.</span>

<span class="sd">  axes :  :class:`AxesWrapper`</span>
<span class="sd">    The axis on which to add the mask.</span>

<span class="sd">  mjsig : float, optional [0.95]</span>
<span class="sd">    The p-value dividing significant from non-significant values.</span>

<span class="sd">  mnsig : float or None, optional [None]</span>
<span class="sd">    The p-value dividing minor significance from non-significant values.</span>

<span class="sd">  mjsigp : dictionary, optional</span>
<span class="sd">    A dictionary of keyword arguments that determine the properties of the</span>
<span class="sd">    (major) significant filled contours. See notes.</span>

<span class="sd">  mnsigp : dictionary, optional</span>
<span class="sd">    A dictionary of keyword arguments that determine the properties of the</span>
<span class="sd">    minor significant filled contours. See notes.</span>

<span class="sd">  nsigp : dictionary, optional</span>
<span class="sd">    A dictionary of keyword arguments that determine the properties of the</span>
<span class="sd">    non-significant filled contour. See notes.</span>

<span class="sd">  transpose : bool or None, optional [None]</span>
<span class="sd">    If True, transpose the axes of the plot.</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  The significance mask is plotted as three (or five) filled contours, with</span>
<span class="sd">  boundaries at [-1.1, -mjsig, mjsig, 1.1] or [-1.1, -mjsig, -mnsig, mnsig,</span>
<span class="sd">  mjsig, 1.1]. Their respective graphical properties can be set using the</span>
<span class="sd">  dictionary kw arguments.</span>

<span class="sd">  By default, the non-significant contours are set to be invisible and the</span>
<span class="sd">  significant contours are set to a hatching pattern; this is equivalent to</span>
<span class="sd">  passing in mjsigp = dict(alpha = 0., hatch = &#39;...&#39;) and nsigp = dict(visible</span>
<span class="sd">  = False). Any property of the filled contour can be set.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  :class:`AxesWrapper` object with plot.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Z</span> <span class="o">=</span> <span class="n">pval</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">Z</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Variable to contour must have two non-degenerate axes.&#39;</span>
  <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">axes</span>

  <span class="c1"># If a vertical axis is present transpose the plot</span>
  <span class="kn">from</span> <span class="nn">pygeode.axis</span> <span class="kn">import</span> <span class="n">ZAxis</span><span class="p">,</span> <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>
  <span class="k">if</span> <span class="n">transpose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ZAxis</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lat</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lon</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
  <span class="k">elif</span> <span class="n">transpose</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>

  <span class="k">if</span> <span class="n">mjsigp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mjsigp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">hatch</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">mnsigp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mnsigp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">hatch</span> <span class="o">=</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">nsigp</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">nsigp</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">mnsig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="o">-</span><span class="n">mjsig</span><span class="p">,</span> <span class="n">mjsig</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">modifycontours</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">mjsigp</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">modifycontours</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>    <span class="o">**</span><span class="n">nsigp</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="o">-</span><span class="n">mnsig</span><span class="p">,</span><span class="o">-</span><span class="n">mjsig</span><span class="p">,</span> <span class="n">mjsig</span><span class="p">,</span> <span class="n">mnsig</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">modifycontours</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="o">**</span><span class="n">mjsigp</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">modifycontours</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">mnsigp</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">modifycontours</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>    <span class="o">**</span><span class="n">nsigp</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">axes</span></div>
<span class="c1"># }}}</span>

<span class="c1"># Do a stream plot</span>
<div class="viewcode-block" id="vstreamplot"><a class="viewcode-back" href="../../../plot.html#pygeode.vstreamplot">[docs]</a><span class="k">def</span> <span class="nf">vstreamplot</span><span class="p">(</span><span class="n">varu</span><span class="p">,</span> <span class="n">varv</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lblx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lbly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Create a streamplot from two variables.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">U</span> <span class="o">=</span> <span class="n">varu</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
  <span class="n">V</span> <span class="o">=</span> <span class="n">varv</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">V</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Variables to quiver must have two non-degenerate axes.&#39;</span>
  <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">axes</span>

  <span class="kn">from</span> <span class="nn">pygeode.axis</span> <span class="kn">import</span> <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>
  <span class="c1"># If a vertical axis is present transpose the plot</span>
  <span class="kn">from</span> <span class="nn">pygeode.axis</span> <span class="kn">import</span> <span class="n">ZAxis</span><span class="p">,</span> <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>
  <span class="k">if</span> <span class="n">transpose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ZAxis</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lat</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lon</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
  <span class="k">elif</span> <span class="n">transpose</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
  <span class="n">u</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>
  <span class="n">v</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>

  <span class="nb">map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="p">{})</span>
  <span class="n">mapd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mapdecor&#39;</span><span class="p">,</span> <span class="p">{})</span>

  <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lon</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lat</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">axes</span> <span class="o">=</span> <span class="n">build_projection</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="nb">map</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">axes</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>

  <span class="n">axes</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="c1"># Apply the custom axes args</span>
  <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wr</span><span class="o">.</span><span class="n">ismapaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">decorate_projection</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">mapd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">set_xaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">lblx</span><span class="p">)</span>
      <span class="n">set_yaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">lbly</span><span class="p">)</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="n">_getplotatts</span><span class="p">(</span><span class="n">varu</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="n">_buildvartitle</span><span class="p">(</span><span class="n">varu</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">plt</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">axes</span></div>
<span class="c1"># }}}</span>

<span class="c1"># Do a quiver plot</span>
<div class="viewcode-block" id="vquiver"><a class="viewcode-back" href="../../../plot.html#pygeode.vquiver">[docs]</a><span class="k">def</span> <span class="nf">vquiver</span><span class="p">(</span><span class="n">varu</span><span class="p">,</span> <span class="n">varv</span><span class="p">,</span> <span class="n">varc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lblx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lbly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Create a quiver plot from two variables.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">U</span> <span class="o">=</span> <span class="n">varu</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
  <span class="n">V</span> <span class="o">=</span> <span class="n">varv</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">V</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Variables to quiver must have two non-degenerate axes.&#39;</span>
  <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">V</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="s1">&#39;Variables U and V must have the same axes.&#39;</span>
  <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">axes</span>

  <span class="k">if</span> <span class="n">varc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">varc</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">C</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="s1">&#39;Color values must have same axes as U and V&#39;</span>

  <span class="kn">from</span> <span class="nn">pygeode.axis</span> <span class="kn">import</span> <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>
  <span class="c1"># If a vertical axis is present transpose the plot</span>
  <span class="kn">from</span> <span class="nn">pygeode.axis</span> <span class="kn">import</span> <span class="n">ZAxis</span><span class="p">,</span> <span class="n">Lat</span><span class="p">,</span> <span class="n">Lon</span>
  <span class="k">if</span> <span class="n">transpose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ZAxis</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lat</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lon</span><span class="p">):</span>
      <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>
  <span class="k">elif</span> <span class="n">transpose</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
  <span class="n">u</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>
  <span class="n">v</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">varc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">scalevalues</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span>

  <span class="nb">map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="p">{})</span>
  <span class="n">mapd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mapdecor&#39;</span><span class="p">,</span> <span class="p">{})</span>

  <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lon</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lat</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">axes</span> <span class="o">=</span> <span class="n">build_projection</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="nb">map</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">axes</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">varc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="c1"># Apply the custom axes args</span>
  <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wr</span><span class="o">.</span><span class="n">ismapaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">decorate_projection</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="o">**</span><span class="n">mapd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">set_xaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">lblx</span><span class="p">)</span>
      <span class="n">set_yaxis</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">lbly</span><span class="p">)</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="n">_getplotatts</span><span class="p">(</span><span class="n">varu</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="n">_buildvartitle</span><span class="p">(</span><span class="n">varu</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">plt</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">axes</span></div>
<span class="c1"># }}}</span>

<span class="c1"># Generic catch all interface (plotvar replacement)</span>
<div class="viewcode-block" id="showvar"><a class="viewcode-back" href="../../../plot.html#pygeode.showvar">[docs]</a><span class="k">def</span> <span class="nf">showvar</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;Plot variable, showing a contour plot for 2d variables or a line plot for</span>
<span class="sd">  1d variables.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  var :  :class:`Var`</span>
<span class="sd">     The variable to plot. Should have either 1 or 2 non-degenerate axes.</span>
<span class="sd">     Arguments below relevant only for the 1 dimensional case are labelled [1D],</span>
<span class="sd">     those relevant only for the 2 dimensional case are labelled [2D].</span>

<span class="sd">  fmt : string, optional</span>
<span class="sd">    [1D] matplotlib format to plot line. See :func:`matplotlib.plot()`. Will also</span>
<span class="sd">    be recognized as the second positional argument (after var).</span>

<span class="sd">  type : string, optional [&#39;clf&#39;]</span>
<span class="sd">    [2D] style of plot to produce. See Notes.</span>

<span class="sd">  axes : :class:`AxesWrapper` instance, optional</span>
<span class="sd">    Axes object on which to plot variable. A new one is created if this is not specified.</span>

<span class="sd">  transpose: boolean, optional [False]</span>
<span class="sd">    If True, reverse axes.</span>

<span class="sd">  lblx: boolean, optional [True]</span>
<span class="sd">    If True, label horizontal axes</span>

<span class="sd">  lbly: boolean, optional [True]</span>
<span class="sd">    If True, label vertical axes</span>

<span class="sd">  *args, **kwargs :</span>
<span class="sd">    Further arguments are passed on to the underlying plotting routine. See</span>
<span class="sd">    Notes.</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  This function is intended as the simplest way to display the contents of a</span>
<span class="sd">  variable, choosing appropriate parameter values as automatically as possible.</span>
<span class="sd">  For 1d variables it calls :func:`Var.vplot()`, and for 2d variables</span>
<span class="sd">  :func:`Var.vcontour`. In the latter case, if filled contours were produced, it</span>
<span class="sd">  calls :func:`AxesWrapper.colorbar()`. A dictionary ``colorbar`` can be provided to</span>
<span class="sd">  pass arguments through. Setting ``colorbar`` to ``False`` suppresses the</span>
<span class="sd">  colorbar.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  :class:`AxesWrapper` object with plot.</span>

<span class="sd">  See Also</span>
<span class="sd">  --------</span>
<span class="sd">  vplot, vcontour, colorbar</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Z</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">Z</span><span class="o">.</span><span class="n">naxes</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Variable </span><span class="si">%s</span><span class="s1"> has </span><span class="si">%d</span><span class="s1"> non-generate axes; must have 1 or 2.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">naxes</span><span class="p">)</span>

  <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

  <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
  <span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">Z</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">vplot</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>

  <span class="k">elif</span> <span class="n">Z</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_parse_autofmt_kwargs</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">))</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">vcontour</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>

    <span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">find_plot</span><span class="p">(</span><span class="n">wr</span><span class="o">.</span><span class="n">Contourf</span><span class="p">)</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">find_plot</span><span class="p">(</span><span class="n">wr</span><span class="o">.</span><span class="n">Contour</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span> <span class="ow">and</span> <span class="n">cf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">cl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cbar</span><span class="p">[</span><span class="s1">&#39;lcnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cl</span>
      <span class="n">ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar</span><span class="p">)</span>

  <span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pyl</span>
  <span class="k">if</span> <span class="n">pyl</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ax</span></div>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">showcol</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">4.1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Plot column of contour plots. Superseded by :func:`showgrid`.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  v :  list of lists of :class:`Var`</span>
<span class="sd">     The variables to plot. Should have either 1 or 2 non-degenerate axes.</span>

<span class="sd">  Notes</span>
<span class="sd">  -----</span>
<span class="sd">  This function is intended as the simplest way to display the contents of a variable,</span>
<span class="sd">  choosing appropriate parameter values as automatically as possible.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]</span>

  <span class="k">assert</span> <span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">naxes</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Variables </span><span class="si">%s</span><span class="s1"> has </span><span class="si">%d</span><span class="s1"> non-generate axes; must have 1 or 2.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">naxes</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">Z</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">assert</span> <span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="n">z</span><span class="o">.</span><span class="n">naxes</span><span class="p">,</span> <span class="s1">&#39;All variables must have the same number of non-generate dimensions&#39;</span>
    <span class="c1">#assert all([a == b for a, b in zip(Z[0].axes, z.axes)])</span>

  <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ydat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">:</span>
      <span class="n">lblx</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="n">vs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">ax</span> <span class="o">=</span> <span class="n">vplot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">lblx</span> <span class="o">=</span> <span class="n">lblx</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
      <span class="n">axs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>
      <span class="n">ydat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">find_plot</span><span class="p">(</span><span class="n">wr</span><span class="o">.</span><span class="n">Plot</span><span class="p">)</span><span class="o">.</span><span class="n">plot_args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">Ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ydat</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ydat</span><span class="p">]))</span>
    <span class="n">Ax</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ylim</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">:</span>
      <span class="n">lblx</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="n">vs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">ax</span> <span class="o">=</span> <span class="n">vcontour</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">lblx</span> <span class="o">=</span> <span class="n">lblx</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
      <span class="n">axs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>

    <span class="n">Ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">))</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">Ax</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_plot</span><span class="p">(</span><span class="n">wr</span><span class="o">.</span><span class="n">Contourf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span> <span class="ow">and</span> <span class="n">cf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">Ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">Ax</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar</span><span class="p">)</span>

  <span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pyl</span>
  <span class="k">if</span> <span class="n">pyl</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span> <span class="n">Ax</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">Ax</span>
<span class="c1"># }}}</span>

<div class="viewcode-block" id="showgrid"><a class="viewcode-back" href="../../../plot.html#pygeode.showgrid">[docs]</a><span class="k">def</span> <span class="nf">showgrid</span><span class="p">(</span><span class="n">vf</span><span class="p">,</span> <span class="n">vl</span><span class="o">=</span><span class="p">[],</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span> <span class="n">lbl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Create grid of contour plots of multiple variables.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  vf :  list of lists of :class:`Var`</span>
<span class="sd">    The variables to plot. Should have 2 non-degenerate axes.</span>

<span class="sd">  ncol : integer</span>
<span class="sd">    Number of columns</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="kn">from</span> <span class="nn">pygeode</span> <span class="kn">import</span> <span class="n">Var</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vf</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span> <span class="n">vf</span> <span class="o">=</span> <span class="p">[</span><span class="n">vf</span><span class="p">]</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span> <span class="n">vl</span> <span class="o">=</span> <span class="p">[</span><span class="n">vl</span><span class="p">]</span>

  <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vf</span><span class="p">]),</span> <span class="s1">&#39;Variables (vf) should have 2 degenerate axes.&#39;</span>
  <span class="n">nVf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vf</span><span class="p">)</span>

  <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">]),</span> <span class="s1">&#39;Variables (vl) should have 2 degenerate axes.&#39;</span>
  <span class="n">nVl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">nVf</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nVl</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">assert</span> <span class="n">nVl</span> <span class="o">==</span> <span class="n">nVf</span><span class="p">,</span> <span class="s1">&#39;Must have the same number of filled and contour-line variables.&#39;</span>

  <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

  <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_parse_autofmt_kwargs</span><span class="p">(</span><span class="n">vf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">)</span>

  <span class="n">cbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">))</span>
  <span class="n">xpad</span> <span class="o">=</span> <span class="mf">0.</span>
  <span class="n">ypad</span> <span class="o">=</span> <span class="mf">0.</span>

  <span class="n">kwlines</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">if</span> <span class="n">nVl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">kwlines</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">kwlines</span><span class="p">[</span><span class="s1">&#39;clines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;clines&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linewidths&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwlines</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

  <span class="n">kwfill</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">if</span> <span class="n">nVf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">kwfill</span><span class="p">[</span><span class="s1">&#39;clevs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;clevs&#39;</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
    <span class="n">kwfill</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwlines</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">cbar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
        <span class="n">ypad</span> <span class="o">=</span> <span class="n">cbar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">xpad</span> <span class="o">=</span> <span class="n">cbar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>


  <span class="n">kwcb</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="n">nV</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nVl</span><span class="p">,</span> <span class="n">nVf</span><span class="p">)</span>
  <span class="n">nrow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nV</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">ncol</span><span class="p">))</span>

  <span class="n">axpad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axpad&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
  <span class="n">aypad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;aypad&#39;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">lbl</span><span class="p">:</span>
    <span class="n">axpadl</span> <span class="o">=</span> <span class="n">axpad</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lblxpad&#39;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="n">aypadl</span> <span class="o">=</span> <span class="n">aypad</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lblypad&#39;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">axpadl</span> <span class="o">=</span> <span class="n">axpad</span>
    <span class="n">aypadl</span> <span class="o">=</span> <span class="n">aypad</span>

  <span class="n">axw</span><span class="p">,</span> <span class="n">axh</span> <span class="o">=</span> <span class="n">size</span>

  <span class="n">axs</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nV</span><span class="p">):</span>
    <span class="n">lblx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">ncol</span> <span class="o">==</span> <span class="n">nrow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">lbly</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">ncol</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">nVf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">v</span> <span class="o">=</span> <span class="n">vf</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">nVf</span><span class="p">]</span>
      <span class="n">kwfill</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">ax</span> <span class="o">=</span> <span class="n">vcontour</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lblx</span> <span class="o">=</span> <span class="n">lblx</span><span class="p">,</span> <span class="n">lbly</span> <span class="o">=</span> <span class="n">lbly</span><span class="p">,</span> <span class="o">**</span><span class="n">kwfill</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nVl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">v</span> <span class="o">=</span> <span class="n">vl</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">nVl</span><span class="p">]</span>
      <span class="n">kwlines</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">ax</span> <span class="o">=</span> <span class="n">vcontour</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lblx</span> <span class="o">=</span> <span class="n">lblx</span><span class="p">,</span> <span class="n">lbly</span> <span class="o">=</span> <span class="n">lbly</span><span class="p">,</span> <span class="o">**</span><span class="n">kwlines</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wr</span><span class="p">,</span> <span class="s1">&#39;BasemapAxes&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">wr</span><span class="o">.</span><span class="n">BasemapAxes</span><span class="p">):</span>
      <span class="n">w</span> <span class="o">=</span> <span class="n">axw</span>
      <span class="n">h</span> <span class="o">=</span> <span class="n">axh</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">pl</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pad</span>
      <span class="k">if</span> <span class="n">lblx</span><span class="p">:</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">aypadl</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">aypad</span>
      <span class="k">if</span> <span class="n">lbly</span><span class="p">:</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">axpadl</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">axpad</span>
      <span class="n">h</span> <span class="o">=</span> <span class="n">axh</span> <span class="o">+</span> <span class="n">py</span>
      <span class="n">w</span> <span class="o">=</span> <span class="n">axw</span> <span class="o">+</span> <span class="n">px</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="n">px</span><span class="o">-</span><span class="n">pr</span><span class="p">,</span> <span class="n">py</span><span class="o">-</span><span class="n">pt</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">pt</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">ncol</span> <span class="o">==</span> <span class="n">ncol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
      <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">row</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ncol</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

  <span class="n">Ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>

  <span class="n">cf</span> <span class="o">=</span> <span class="n">Ax</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_plot</span><span class="p">(</span><span class="n">wr</span><span class="o">.</span><span class="n">Contourf</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">cbar</span> <span class="ow">and</span> <span class="n">cf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">Ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">Ax</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar</span><span class="p">)</span>

  <span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pyl</span>
  <span class="k">if</span> <span class="n">pyl</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span> <span class="n">Ax</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">Ax</span></div>
<span class="c1"># }}}</span>

<div class="viewcode-block" id="showlines"><a class="viewcode-back" href="../../../plot.html#pygeode.showlines">[docs]</a><span class="k">def</span> <span class="nf">showlines</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">fmts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">4.1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">lblx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lbly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Produce line plots of a list of 1D variables on a single figure.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  vs :  list of :class:`Var`</span>
<span class="sd">     The variables to plot. Should all have 1 non-degenerate axis.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">]</span>

  <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">Z</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">z</span><span class="o">.</span><span class="n">naxes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Variable </span><span class="si">%s</span><span class="s1"> has </span><span class="si">%d</span><span class="s1"> non-generate axes; must have 1.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">naxes</span><span class="p">)</span>

  <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

  <span class="n">ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
  <span class="n">ydat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fmts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fmts</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
      <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmts</span>

    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">lbl</span> <span class="o">=</span> <span class="n">labels</span>

    <span class="n">vplot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
    <span class="n">ydat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">find_plot</span><span class="p">(</span><span class="n">wr</span><span class="o">.</span><span class="n">Plot</span><span class="p">)</span><span class="o">.</span><span class="n">plot_args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

  <span class="c1">#ylim = (np.min([np.min(y) for y in ydat]), np.max([np.max(y) for y in ydat]))</span>
  <span class="c1">#kwargs.update(dict(ylim=ylim))</span>

  <span class="n">kwleg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">kwleg</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pyl</span>
  <span class="k">if</span> <span class="n">pyl</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span> <span class="n">ax</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ax</span></div>
<span class="c1"># }}}</span>

<span class="k">def</span> <span class="nf">savepages</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">psize</span><span class="o">=</span><span class="s1">&#39;A4&#39;</span><span class="p">,</span> <span class="n">marg</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<span class="c1"># {{{</span>
  <span class="n">sizes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">A4</span> <span class="o">=</span> <span class="p">(</span><span class="mf">8.3</span><span class="p">,</span> <span class="mf">11.7</span><span class="p">),</span>
              <span class="n">A4l</span> <span class="o">=</span> <span class="p">(</span><span class="mf">11.7</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">psize</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">:</span>
    <span class="n">pwidth</span><span class="p">,</span> <span class="n">pheight</span> <span class="o">=</span> <span class="n">sizes</span><span class="p">[</span><span class="n">psize</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">pwidth</span><span class="p">,</span> <span class="n">pheight</span> <span class="o">=</span> <span class="n">psize</span>

  <span class="n">hmarg</span> <span class="o">=</span> <span class="n">marg</span>
  <span class="n">wmarg</span> <span class="o">=</span> <span class="n">marg</span>
  <span class="n">psize</span> <span class="o">=</span> <span class="p">(</span><span class="n">pwidth</span><span class="p">,</span> <span class="n">pheight</span><span class="p">)</span>

  <span class="n">fwidth</span> <span class="o">=</span> <span class="n">pwidth</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">wmarg</span>
  <span class="n">fheight</span> <span class="o">=</span> <span class="n">pheight</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">hmarg</span>

  <span class="n">ymarg</span> <span class="o">=</span> <span class="n">hmarg</span><span class="o">/</span><span class="n">pheight</span>
  <span class="n">xmarg</span> <span class="o">=</span> <span class="n">wmarg</span><span class="o">/</span><span class="n">pwidth</span>

  <span class="n">y</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">ymarg</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">xmarg</span>

  <span class="n">ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">psize</span><span class="p">)</span>
  <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> <span class="kn">import</span> <span class="n">PdfPages</span>
  <span class="n">pp</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

  <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">nfigs</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">hlast</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">figs</span><span class="p">:</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">pwidth</span> <span class="o">*</span> <span class="n">scl</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">pheight</span> <span class="o">*</span> <span class="n">scl</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">xmarg</span><span class="p">:</span>
      <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">add_axis</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">w</span>
      <span class="n">hlast</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">hlast</span><span class="p">)</span>
      <span class="n">nfigs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">xmarg</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">hlast</span>

      <span class="k">if</span> <span class="n">nfigs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">-</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">ymarg</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;page</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">page</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">wr</span><span class="o">.</span><span class="n">AxesWrapper</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">psize</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">ymarg</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Page </span><span class="si">%d</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> figures.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">nfigs</span><span class="p">))</span>
        <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">nfigs</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
      <span class="n">ax</span><span class="o">.</span><span class="n">add_axis</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span>
      <span class="n">hlast</span> <span class="o">=</span> <span class="n">h</span>
      <span class="n">nfigs</span> <span class="o">+=</span> <span class="mi">1</span>

  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Page </span><span class="si">%d</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> figures.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">nfigs</span><span class="p">))</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;page</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">page</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
  <span class="n">pp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># }}}</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;showvar&#39;</span><span class="p">,</span> <span class="s1">&#39;showcol&#39;</span><span class="p">,</span> <span class="s1">&#39;showgrid&#39;</span><span class="p">,</span> <span class="s1">&#39;showlines&#39;</span><span class="p">,</span> <span class="s1">&#39;vplot&#39;</span><span class="p">,</span> <span class="s1">&#39;vscatter&#39;</span><span class="p">,</span> \
          <span class="s1">&#39;vhist&#39;</span><span class="p">,</span> <span class="s1">&#39;vcontour&#39;</span><span class="p">,</span> <span class="s1">&#39;vsigmask&#39;</span><span class="p">,</span> <span class="s1">&#39;vstreamplot&#39;</span><span class="p">,</span> <span class="s1">&#39;vquiver&#39;</span><span class="p">,</span> <span class="s1">&#39;savepages&#39;</span><span class="p">]</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../reference.html">Reference</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../tutorial.html">Tutorial</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../gallery/index.html">Gallery</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Mike Neish, Peter Hitchcock.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>